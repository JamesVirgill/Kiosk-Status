<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kiosk Status Checker | WeChangeUp</title>
  <meta name="description" content="Check kiosk and ATM availability before you go. Real-time status updates for WeChangeUp locations in The Bahamas." />
  <link rel="icon" href="favicon.ico" />
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#0d1f23" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet" />
  
  <style>
    :root {
      --background: hsl(192, 30%, 10%);
      --foreground: hsl(180, 10%, 95%);
      --card: hsl(192, 25%, 12%);
      --card-gradient: linear-gradient(180deg, hsl(192, 25%, 14%) 0%, hsl(192, 25%, 11%) 100%);
      --primary: hsl(185, 100%, 42%);
      --muted: hsl(180, 10%, 65%);
      --border: hsl(192, 20%, 22%);
      --success: hsl(160, 84%, 39%);
      --destructive: hsl(0, 84%, 60%);
      --accent: hsl(45, 93%, 58%);
      --secondary: hsl(192, 20%, 18%);
      --radius: 0.75rem;
      --shadow-card: 0 8px 32px hsla(192, 30%, 5%, 0.4);
      --shadow-glow: 0 0 30px hsla(185, 100%, 42%, 0.2);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, var(--background) 0%, hsl(192, 25%, 14%) 100%);
      color: var(--foreground);
      min-height: 100vh;
      line-height: 1.5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1rem 3rem;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 2rem;
      animation: fadeIn 0.5s ease-out;
    }

    .header-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 64px;
      height: 64px;
      border-radius: 1rem;
      background: hsla(185, 100%, 42%, 0.1);
      border: 1px solid hsla(185, 100%, 42%, 0.3);
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow-glow);
    }

    .header-icon svg { width: 32px; height: 32px; color: var(--primary); }

    .header h1 {
      font-size: clamp(1.75rem, 5vw, 3rem);
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .header h1 span.gradient {
      background: linear-gradient(90deg, var(--primary), hsla(185, 100%, 42%, 0.7));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header h1 .version {
      font-size: 0.75rem;
      font-weight: 400;
      color: var(--muted);
      margin-left: 0.75rem;
      vertical-align: middle;
      opacity: 0.8;
    }

    .header p { color: var(--muted); font-size: 1.125rem; }

    /* Tips Section */
    .tips-card {
      background: var(--card-gradient);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1rem 1.25rem;
      margin-bottom: 2rem;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      cursor: pointer;
      transition: border-color 0.3s ease;
      animation: fadeIn 0.5s ease-out 0.1s both;
    }

    .tips-card:hover { border-color: hsla(185, 100%, 42%, 0.4); }

    .tips-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .tips-header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .tips-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: hsla(45, 93%, 58%, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .tips-icon svg { width: 20px; height: 20px; color: var(--accent); }

    .tips-title { font-weight: 600; color: var(--foreground); }
    .tips-subtitle { font-size: 0.875rem; color: var(--muted); }

    .tips-chevron {
      width: 20px;
      height: 20px;
      color: var(--muted);
      transition: transform 0.2s ease;
    }

    .tips-card.open .tips-chevron { transform: rotate(180deg); }

    .tips-content {
      display: none;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border);
    }

    .tips-card.open .tips-content { display: block; }

    .tips-content p { color: var(--muted); margin-bottom: 1rem; }

    .tips-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .tips-item {
      padding: 1rem;
      background: hsla(192, 20%, 18%, 0.5);
      border: 1px solid var(--border);
      border-radius: var(--radius);
    }

    .tips-item-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .tips-item-header svg { width: 20px; height: 20px; color: var(--primary); }
    .tips-item-header h4 { font-weight: 600; color: var(--foreground); }
    .tips-item p { font-size: 0.875rem; color: var(--muted); }

    /* Main Grid */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 2rem;
      max-width: 1100px;
      margin: 0 auto;
    }

    @media (min-width: 1024px) {
      .main-grid { grid-template-columns: 2fr 1fr; }
    }

    /* Controls */
    .controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .controls-left {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .select-wrapper {
      position: relative;
      min-width: 180px;
    }

    .select-wrapper select {
      width: 100%;
      padding: 0.625rem 2.5rem 0.625rem 1rem;
      background: var(--secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--foreground);
      font-family: inherit;
      font-size: 0.875rem;
      cursor: pointer;
      appearance: none;
      transition: border-color 0.3s ease;
    }

    .select-wrapper select:hover,
    .select-wrapper select:focus {
      border-color: var(--primary);
      outline: none;
    }

    .select-wrapper::after {
      content: '';
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-top: 5px solid var(--muted);
      pointer-events: none;
    }

    .refresh-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--foreground);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .refresh-btn:hover {
      border-color: var(--primary);
      background: hsla(185, 100%, 42%, 0.1);
    }

    .refresh-btn svg { width: 16px; height: 16px; }
    .refresh-btn.spinning svg { animation: spin 1s linear infinite; }

    .last-updated { font-size: 0.875rem; color: var(--muted); }
    .location-count { font-size: 0.875rem; color: var(--muted); }

    /* Kiosk Cards */
    .kiosk-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
    }

    .kiosk-card {
      background: var(--card-gradient);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      box-shadow: var(--shadow-card);
      transition: all 0.3s ease;
      animation: fadeIn 0.5s ease-out both;
    }

    .kiosk-card:nth-child(1) { animation-delay: 0.1s; }
    .kiosk-card:nth-child(2) { animation-delay: 0.2s; }
    .kiosk-card:nth-child(3) { animation-delay: 0.3s; }
    .kiosk-card:nth-child(4) { animation-delay: 0.4s; }

    .kiosk-card:hover {
      border-color: hsla(185, 100%, 42%, 0.4);
      box-shadow: var(--shadow-glow);
    }

    .kiosk-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .kiosk-name {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--foreground);
      line-height: 1.3;
    }

    .kiosk-address {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      margin-top: 0.375rem;
      color: var(--muted);
      font-size: 0.875rem;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .kiosk-address:hover { color: var(--primary); }
    .kiosk-address svg { width: 14px; height: 14px; flex-shrink: 0; }

    /* Status Badge */
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.25rem 0.625rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      white-space: nowrap;
    }

    .status-badge.online {
      background: hsla(160, 84%, 39%, 0.1);
      border: 1px solid hsla(160, 84%, 39%, 0.3);
      color: var(--success);
    }

    .status-badge.offline {
      background: hsla(0, 84%, 60%, 0.1);
      border: 1px solid hsla(0, 84%, 60%, 0.3);
      color: var(--destructive);
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .status-badge.online .status-dot {
      background: var(--success);
      animation: pulse-success 2s ease-in-out infinite;
    }

    .status-badge.offline .status-dot {
      background: var(--destructive);
      animation: pulse-error 2s ease-in-out infinite;
    }

    /* Feedback Form */
    .feedback-card {
      background: var(--card-gradient);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: var(--shadow-card);
      animation: fadeIn 0.5s ease-out 0.3s both;
    }

    .feedback-card h2 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--foreground);
      margin-bottom: 0.5rem;
    }

    .feedback-card > p {
      font-size: 0.875rem;
      color: var(--muted);
      margin-bottom: 1.5rem;
    }

    .form-group { margin-bottom: 1rem; }

    .form-group label {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--foreground);
      margin-bottom: 0.5rem;
    }

    .form-group select,
    .form-group input {
      width: 100%;
      padding: 0.625rem 1rem;
      background: var(--secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--foreground);
      font-family: inherit;
      font-size: 0.875rem;
      transition: border-color 0.3s ease;
    }

    .form-group select:focus,
    .form-group input:focus {
      border-color: var(--primary);
      outline: none;
    }

    .form-group input::placeholder { color: var(--muted); }

    .submit-btn {
      width: 100%;
      padding: 0.75rem 1.5rem;
      background: var(--primary);
      border: none;
      border-radius: var(--radius);
      color: var(--background);
      font-family: inherit;
      font-size: 0.875rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      transition: all 0.3s ease;
    }

    .submit-btn:hover { filter: brightness(1.1); }
    .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .submit-btn svg { width: 16px; height: 16px; }

    /* Success State */
    .feedback-success {
      text-align: center;
      padding: 2rem 1rem;
    }

    .feedback-success .icon-circle {
      width: 64px;
      height: 64px;
      margin: 0 auto 1rem;
      border-radius: 50%;
      background: hsla(160, 84%, 39%, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .feedback-success .icon-circle svg {
      width: 32px;
      height: 32px;
      color: var(--success);
    }

    .feedback-success h3 {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--foreground);
      margin-bottom: 0.5rem;
    }

    .feedback-success p { font-size: 0.875rem; color: var(--muted); }

    /* Footer */
    footer {
      text-align: center;
      margin-top: 4rem;
      animation: fadeIn 0.5s ease-out 0.5s both;
    }

    footer a {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--muted);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    footer a:hover { color: var(--primary); }
    footer a svg { width: 16px; height: 16px; }

    /* Loading */
    .loading { text-align: center; color: var(--muted); padding: 2rem; grid-column: 1 / -1; }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes pulse-success {
      0%, 100% { box-shadow: 0 0 0 0 hsla(160, 84%, 39%, 0.4); }
      50% { box-shadow: 0 0 0 8px hsla(160, 84%, 39%, 0); }
    }

    @keyframes pulse-error {
      0%, 100% { box-shadow: 0 0 0 0 hsla(0, 84%, 60%, 0.4); }
      50% { box-shadow: 0 0 0 8px hsla(0, 84%, 60%, 0); }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
      </div>
      <h1>
        <span class="gradient">Check Kiosk Status</span>
        <span class="version">(v1.0)</span>
      </h1>
      <p>Check availability before you go!</p>
    </header>

    <!-- Tips Section -->
    <div class="tips-card" onclick="this.classList.toggle('open')">
      <div class="tips-header">
        <div class="tips-header-left">
          <div class="tips-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
          </div>
          <div>
            <div class="tips-title">Getting Started</div>
            <div class="tips-subtitle">Learn how to use this web app</div>
          </div>
        </div>
        <svg class="tips-chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
      </div>
      <div class="tips-content">
        <p>Welcome to The Kiosk Status Checker. This app helps you determine whether a kiosk or ATM is up and running before making the trip. Add it to your phone for one-tap access anytime.</p>
        <div class="tips-grid">
          <div class="tips-item">
            <div class="tips-item-header">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>
              <h4>Android</h4>
            </div>
            <p>Tap the three-dot menu, choose "Add to Home screen" (or "Install"), then confirm.</p>
          </div>
          <div class="tips-item">
            <div class="tips-item-header">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z"/><path d="M10 2c1 .5 2 2 2 5"/></svg>
              <h4>iOS (Safari)</h4>
            </div>
            <p>Tap the Share button (square with arrow), then "Add to Home Screen."</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Grid -->
    <div class="main-grid">
      <!-- Status Section -->
      <div>
        <div class="controls">
          <div class="controls-left">
            <div class="select-wrapper">
              <select id="companySelect">
                <option value="wechangeup">WeChangeUp</option>
                <option value="coming-soon" disabled>More Coming Soon</option>
              </select>
            </div>
            <button class="refresh-btn" id="refreshBtn" title="Refresh">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>
            </button>
            <span class="last-updated" id="lastUpdated"></span>
          </div>
          <span class="location-count" id="locationCount">4 locations</span>
        </div>

        <div class="kiosk-grid" id="kioskGrid">
          <div class="loading">Loading kiosk status...</div>
        </div>
      </div>

      <!-- Feedback Form -->
      <div>
        <div class="feedback-card" id="feedbackCard">
          <h2>Customer Feedback</h2>
          <p>Tell us which company you'd like to see next.</p>
          <form id="feedbackForm">
            <div class="form-group">
              <label for="company">Which company?</label>
              <select id="company" required>
                <option value="">Select a company</option>
                <option value="Quick Pay">Quick Pay</option>
                <option value="RBC">RBC</option>
                <option value="Scotia">Scotia</option>
                <option value="BOB">BOB</option>
                <option value="Commonwealth">Commonwealth</option>
                <option value="CIBC">CIBC</option>
              </select>
            </div>
            <div class="form-group">
              <label for="helpful">Was this site helpful?</label>
              <select id="helpful" required>
                <option value="">Select an option</option>
                <option value="Yes">Yes</option>
                <option value="No">No</option>
              </select>
            </div>
            <div class="form-group">
              <label for="name">Name (optional)</label>
              <input type="text" id="name" placeholder="Your name" />
            </div>
            <div class="form-group">
              <label for="email">Email (optional)</label>
              <input type="email" id="email" placeholder="your@email.com" />
            </div>
            <div class="form-group">
              <label for="phone">Phone (optional)</label>
              <input type="tel" id="phone" placeholder="Your phone number" />
            </div>
            <button type="submit" class="submit-btn">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
              Submit Feedback
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <a href="https://wechangeup.net" target="_blank" rel="noopener noreferrer">
        <span>Back to WeChangeUp.net</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg>
      </a>
    </footer>
  </div>

  <script src="supabaseClient.js"></script>
  <script>
    const locationMap = {
      "Smitty's": { name: "Smitty's Sandyport", address: "101-103 Church Street, Sandyport" },
      "QHC Carmichael": { name: "Quality Home Center Carmichael", address: "Baillou Hill Rd, Nassau" },
      "Quality Home Center": { name: "Quality Home Center Prince Charles", address: "Prince Charles Drive, Nassau" },
      "Rubis": { name: "Rubis", address: "East St & Soldier Rd, Nassau" }
    };

    const kioskGrid = document.getElementById('kioskGrid');
    const refreshBtn = document.getElementById('refreshBtn');
    const lastUpdatedEl = document.getElementById('lastUpdated');

    async function loadKiosks() {
      refreshBtn.classList.add('spinning');
      
      try {
        const { data, error } = await supabase
          .from('kiosks')
          .select('*')
          .order('timestamp', { ascending: false });

        if (error) {
          console.error('Error loading kiosks:', error.message);
          return;
        }

        // Get latest report per location
        const latestReports = {};
        data?.forEach(row => {
          if (!latestReports[row.location] || row.timestamp > latestReports[row.location].timestamp) {
            latestReports[row.location] = row;
          }
        });

        let latestTime = null;
        const kiosks = Object.entries(locationMap).map(([raw, display]) => {
          const report = latestReports[raw];
          const reportTime = report ? new Date(report.timestamp) : null;
          if (reportTime && (!latestTime || reportTime > latestTime)) {
            latestTime = reportTime;
          }
          return {
            name: display.name,
            address: display.address,
            status: report?.status === 'error' ? 'offline' : 'online'
          };
        });

        renderKiosks(kiosks);
        lastUpdatedEl.textContent = latestTime 
          ? `Last status change: ${latestTime.toLocaleTimeString()}` 
          : `Last status change: ${new Date().toLocaleTimeString()}`;
          
      } catch (err) {
        console.error('Failed to load kiosks:', err);
      } finally {
        refreshBtn.classList.remove('spinning');
      }
    }

    function renderKiosks(kiosks) {
      const mapsIcon = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>`;
      
      kioskGrid.innerHTML = kiosks.map(kiosk => {
        const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(kiosk.address + ', Bahamas')}`;
        const statusLabel = kiosk.status === 'online' ? 'Available' : 'Out of Use';
        
        return `
          <div class="kiosk-card">
            <div class="kiosk-header">
              <div>
                <div class="kiosk-name">${kiosk.name}</div>
                <a href="${mapsUrl}" target="_blank" rel="noopener noreferrer" class="kiosk-address">
                  ${mapsIcon}
                  <span>${kiosk.address}</span>
                </a>
              </div>
              <div class="status-badge ${kiosk.status}">
                <span class="status-dot"></span>
                ${statusLabel}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Feedback form
    document.getElementById('feedbackForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const btn = e.target.querySelector('.submit-btn');
      btn.disabled = true;
      btn.textContent = 'Submitting...';

      const formData = {
        company: document.getElementById('company').value,
        helpful: document.getElementById('helpful').value,
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value
      };

      try {
        const response = await fetch('https://formspree.io/f/mzzvekba', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        if (response.ok) {
          document.getElementById('feedbackCard').innerHTML = `
            <div class="feedback-success">
              <div class="icon-circle">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>
              </div>
              <h3>Thank You!</h3>
              <p>Your feedback helps us improve. We appreciate you taking the time!</p>
            </div>
          `;
        } else {
          throw new Error('Submission failed');
        }
      } catch {
        alert('Something went wrong. Please try again.');
        btn.disabled = false;
        btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg> Submit Feedback`;
      }
    });

    // Init
    refreshBtn.addEventListener('click', loadKiosks);
    loadKiosks();
    setInterval(loadKiosks, 5 * 60 * 1000);
  </script>
</body>
</html>
